---
import type { CollectionEntry } from 'astro:content';
import Layout from './Layout.astro';
import { Image } from 'astro:assets';

type Props = CollectionEntry<'releases'>['data'];

const { title, description, pubDate, heroImage, scriptUrl } = Astro.props;

const installCommand = `sh -c "$(curl -sL '${scriptUrl}')"`;
---
<Layout title={title} description={description}>
	<article class="prose dark:prose-invert max-w-none">
		<Image
			width={1020}
			height={510}
			src={heroImage}
			alt={`Hero image for ${title}`}
			class="rounded-lg mb-4"
		/>
		<h1>{title}</h1>
		<p class="text-zinc-500 dark:text-zinc-400">
			Published on {new Date(pubDate).toLocaleDateString('en-US', {
				year: 'numeric',
				month: 'long',
				day: 'numeric',
			})}
		</p>
		<hr />
		<slot /> <!-- The content of your markdown file will be rendered here -->

		<!-- Install/Download Box -->
		<div class="mt-12 not-prose">
			<h3 class="text-2xl font-bold text-zinc-800 dark:text-zinc-100 mb-2">Install / Download</h3>
			<div class="bg-zinc-200 dark:bg-zinc-800 p-4 rounded-md relative text-lg font-mono text-green-600 dark:text-green-400">
				<pre class="m-0 p-0 bg-transparent whitespace-pre-wrap break-all"><code>{installCommand}</code></pre>
				<button id="copy-button" class="absolute top-3 right-3 text-zinc-500 hover:text-zinc-800 dark:text-zinc-400 dark:hover:text-zinc-100 transition-colors" title="Copy command">
					<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
				</button>
			</div>
		</div>

	</article>
</Layout>

<script define:vars={{ installCommand }}>
	const copyButton = document.getElementById('copy-button');
	const originalIcon = copyButton.innerHTML;
	const checkIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-500"><polyline points="20 6 9 17 4 12"></polyline></svg>`;

	copyButton.addEventListener('click', () => {
		navigator.clipboard.writeText(installCommand).then(() => {
			copyButton.innerHTML = checkIcon;
			setTimeout(() => {
				copyButton.innerHTML = originalIcon;
			}, 2000);
		}).catch(err => {
			console.error('Failed to copy command: ', err);
		});
	});
</script>
