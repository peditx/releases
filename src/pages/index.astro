---
// DEBUGGING VERSION 1: Just fetching and displaying titles.
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

// We'll try to fetch the posts and catch any errors immediately.
let posts = [];
let fetchError = null;
try {
  posts = (await getCollection('releases')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );
} catch (e) {
  fetchError = e.message;
}
---

<Layout title="Debugging Mode">
  <div class="container mx-auto max-w-4xl px-4 py-12 text-white relative z-10">
    <header class="text-center mb-12">
        <h1 class="text-4xl font-orbitron text-neon-magenta">SITE DEBUGGING MODE</h1>
        <p class="mt-4 text-gray-400">This is a test to see if we can fetch content without crashing the build.</p>
    </header>

    <main class="bg-black/50 border border-[var(--border-color)] p-8">
        {fetchError && (
            <div class="border border-red-500 bg-red-900/50 p-4 mb-8">
                <h2 class="text-2xl font-bold text-red-400">An error occurred while fetching posts:</h2>
                <pre class="mt-4 whitespace-pre-wrap font-mono text-sm"><code>{fetchError}</code></pre>
            </div>
        )}

        <h2 class="text-2xl font-bold font-orbitron text-neon-cyan mb-4">Found {posts.length} Posts:</h2>
        
        {posts.length > 0 ? (
            <ul class="list-disc pl-5 space-y-2">
                {posts.map(post => (
                    <li>
                        <strong class="text-white">{post.data.title}</strong>
                        <span class="text-gray-500 ml-2">(Slug: {post.slug})</span>
                    </li>
                ))}
            </ul>
        ) : (
            <p class="text-gray-500">No posts were found. If this message appears without an error above, it means the build was successful!</p>
        )}
    </main>
  </div>
</Layout>

